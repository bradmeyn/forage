@model Forage.ViewModels.RestaurantIndexViewModel 
@{ ViewData["Title"] ="Restaurants"; }

<div class="container mb-5">
  <div
    class="border-bottom border-muted my-3 pb-2 d-flex justify-content-between align-items-center"
  >
    
  </div>
  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
     <div class="d-flex align-items-center">
       <div
        class="d-flex flex-grow-1 align-items-center border border-muted border-2 mb-2 px-3 rounded-pill search-container"
      >
        <span class="p-2"><i class="bi bi-search fs-5 text-muted"></i></span>
        <input type="search" class="form-control border-0 p-2" placeholder="Search restaurants"/>
      </div>
       <partial name="_RestaurantFilterMobile" model="Model" />
     </div>
    </div>
  </div>
  <div class="row">
    <div class="col-12 col-md-3">
      <partial name="_RestaurantFilterDesktop" model="Model" />
    </div>

    <div class="col-12 col-md-9 pb-4">

       @foreach (var restaurant in Model.Restaurants)
      {
      <div class="text-dark bg-white d-flex align-items-start border-bottom border-muted shadow-sm mb-3 rounded">
        <div class="rounded p-3">
            <img class="rounded" 
            src="@restaurant.ImageURL" 
            alt="Image of @restaurant.Name" aria-label="Image of @restaurant.Name"
                    style="width: 200px; height: 150px; object-fit: cover;" />
        </div>
        <div class="d-flex flex-grow-1">
            <div class="p-3 w-100">
               <div class="d-flex flex-wrap justify-content-between">
                <a class="text-dark" href="@Url.Action("Detail", "Restaurant", new { id = restaurant.Id })">
    <h2 class="fs-4">@restaurant.Name</h2> 
</a>

                @if (restaurant.OnlineBooking)
                {
                  <button class="d-block ms-auto btn btn-sm btn-primary">Book a table</button>
                }
               </div>
                @{
    double averageRating = 0;
    int numberOfReviews = 0;

    if (restaurant.Reviews != null)
    {
        averageRating = restaurant.Reviews.Select(r => r.Rating).DefaultIfEmpty().Average() ?? 0;
        numberOfReviews = restaurant.Reviews.Count;
    }
}

<div>
    @for (int i = 1; i <= 5; i++)
    {
        if (i <= averageRating)
        {
            <i class="bi bi-star-fill text-primary"></i>
        }
        else if (i - 0.5 <= averageRating)
        {
            <i class="bi bi-star-half text-primary"></i>
        }
        else
        {
            <i class="bi bi-star text-primary"></i>
        }
    }
    <span>(@numberOfReviews)</span>
</div>
              <div class="text-muted">
                    <span>@restaurant.Cuisine</span>
                    &#8226;
                      <span>
                        @(restaurant.Pricing switch
                        {
                            PricingOption.CheapEats => "$",
                            PricingOption.BudgetFriendly => "$$",
                            PricingOption.MidRange => "$$$",
                            PricingOption.FineDining => "$$$$",
                            _ => ""
                        })
                    </span>
                </div>
                <div class="d-flex flex-wrap">
                    @if (restaurant.VegetarianOptions)
                    {
                        <div class="me-4">
                            <i class="bi bi-check2-circle text-success"></i>
                            <span class="text-muted">Vegetarian Options</span>
                        </div>
                    }
                    @if (restaurant.VeganOptions)
                    {
                        <div class="me-4">
                            <i class="bi bi-check2-circle text-success"></i>
                            <span class="text-muted">Vegan Options</span>
                        </div>
                    }
                    @if (restaurant.GlutenFreeOptions)
                    {
                        <div class="me-4">
                            <i class="bi bi-check2-circle text-success"></i>
                            <span class="text-muted">Gluten-Free Options</span>
                        </div>
                    }
                </div>
                
            </div>
        </div>
    </div>
}
    </div>
  </div>
</div>
